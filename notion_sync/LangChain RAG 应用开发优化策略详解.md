# LangChain RAG åº”ç”¨å¼€å‘ä¼˜åŒ–ç­–ç•¥è¯¦è§£

_Last updated: 2025-02-09 02:04:43_

---

# å¼•è¨€ï¼šç†è§£RAGåŠå…¶é‡è¦æ€§


åœ¨å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰åº”ç”¨å¼€å‘ä¸­ï¼Œæ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRetrival-Augmented Generation, RAGï¼‰å·²ç»æˆä¸ºæå‡æ¨¡å‹è¾“å‡ºè´¨é‡çš„å…³é”®æŠ€æœ¯ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨åœ¨LangChainæ¡†æ¶ä¸­å¦‚ä½•ä¼˜åŒ–RAGåº”ç”¨ï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºæ›´æ™ºèƒ½ã€æ›´å‡†ç¡®çš„AIåº”ç”¨ã€‚


# RAGçš„åŸºæœ¬æ¦‚å¿µ


> ğŸ“Œ ä»€ä¹ˆæ˜¯RAG?
RAGæ˜¯ä¸€ç§å°†å¤–éƒ¨çŸ¥è¯†æ£€ç´¢ä¸è¯­è¨€æ¨¡å‹ç”Ÿæˆç›¸ç»“åˆçš„æŠ€æœ¯æ¶æ„ã€‚å®ƒé€šè¿‡æ£€ç´¢ç›¸å…³ä¿¡æ¯æ¥å¢å¼ºLLMçš„çŸ¥è¯†å‚¨å¤‡ï¼Œä»è€Œäº§ç”Ÿæ›´å‡†ç¡®ã€æ›´å¯é çš„è¾“å‡ºã€‚


# ä¸ºä»€ä¹ˆéœ€è¦ä¼˜åŒ–RAGï¼Ÿ


åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒåŸºç¡€çš„RAGå®ç°å¾€å¾€ä¼šé‡åˆ°ä»¥ä¸‹æŒ‘æˆ˜ï¼š


1. æ£€ç´¢å‡†ç¡®æ€§ä¸è¶³

2. å¤æ‚é—®é¢˜å¤„ç†èƒ½åŠ›æœ‰é™

3. çŸ¥è¯†å…³è”ä¸å¤Ÿç´§å¯†

4. å“åº”è´¨é‡ä¸å¤Ÿç¨³å®š

è¿™äº›é—®é¢˜ä¿ƒä½¿æˆ‘ä»¬éœ€è¦é‡‡ç”¨å¤šç§ä¼˜åŒ–ç­–ç•¥æ¥æå‡RAGçš„æ€§èƒ½ã€‚


# ç¬¬ä¸€éƒ¨åˆ†ï¼šå¤šæŸ¥è¯¢æ£€ç´¢ä¼˜åŒ–ç­–ç•¥


# ç†è§£å¤šæŸ¥è¯¢æ£€ç´¢çš„å¿…è¦æ€§


åœ¨RAGåº”ç”¨ä¸­ï¼Œå•ä¸€æŸ¥è¯¢å¾€å¾€æ— æ³•å®Œæ•´æ•æ‰ç”¨æˆ·é—®é¢˜çš„æ‰€æœ‰æ–¹é¢ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·é—®â€Pythonå¦‚ä½•å®ç°å¤šçº¿ç¨‹å¹¶å‘æ§åˆ¶ï¼Ÿâ€œæ—¶ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åŒæ—¶æ£€ç´¢ï¼š


- Pythonçº¿ç¨‹åŸºç¡€çŸ¥è¯†

- å¹¶å‘æ§åˆ¶æœºåˆ¶

- çº¿ç¨‹å®‰å…¨å®ç°æ–¹æ³•

# å¤šæŸ¥è¯¢æ£€ç´¢çš„å·¥ä½œåŸç†


> ğŸ” æ ¸å¿ƒæ€è·¯ï¼šåˆ©ç”¨LLMçš„ç†è§£èƒ½åŠ›ï¼Œå°†ä¸€ä¸ªå¤æ‚æŸ¥è¯¢æ‹†åˆ†æˆ–é‡å†™ä¸ºå¤šä¸ªç›¸å…³æŸ¥è¯¢ï¼Œç„¶åé€šè¿‡èåˆç®—æ³•æ•´åˆæ£€ç´¢ç»“æœã€‚


**å·¥ä½œæµç¨‹**ï¼š


1. **æŸ¥è¯¢é‡å†™**ï¼šLLMå°†åŸå§‹æŸ¥è¯¢è½¬æ¢ä¸ºå¤šä¸ªç›¸å…³æŸ¥è¯¢

2. **å¹¶è¡Œæ£€ç´¢**ï¼šå¯¹æ¯ä¸ªæŸ¥è¯¢è¿›è¡Œç‹¬ç«‹æ£€ç´¢

3. **ç»“æœèåˆ**ï¼šä½¿ç”¨RRFï¼ˆReciprocal Rank Fusionï¼‰ç®—æ³•èåˆæ£€ç´¢ç»“æœ

4. **å†…å®¹ç”Ÿæˆ**ï¼šå°†èåˆåçš„ç»“æœè¾“å…¥LLMç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ

# ä»£ç å®ç°ç¤ºä¾‹


```python
from langchain.retrievers import MultiQueryRetriever
from langchain.chains import LLMChain
from langchain.prompts import PromptTemplate

# 1. åˆ›å»ºå¤šæŸ¥è¯¢æ£€ç´¢å™¨
retriever = MultiQueryRetriever(
    retriever=base_retriever,
    llm=ChatOpenAI(model="gpt-3.5-turbo-16k", temperature=0),
    prompt_template="""åŸºäºç”¨æˆ·çš„é—®é¢˜ï¼Œç”Ÿæˆ3ä¸ªä¸åŒçš„ç›¸å…³æŸ¥è¯¢ï¼š
    åŸå§‹é—®é¢˜: {question}
    ç”Ÿæˆçš„æŸ¥è¯¢åº”è¯¥æ¢ç´¢é—®é¢˜çš„ä¸åŒæ–¹é¢ã€‚
    """
)

# 2. ä½¿ç”¨RRFç®—æ³•èåˆç»“æœ
def rrf_fusion(results, k=60):
    fused_scores = {}
    for rank, doc in enumerate(results):
        doc_str = doc.page_content
        if doc_str not in fused_scores:
            fused_scores[doc_str] = 1.0 / (k + rank + 1)
        else:
            fused_scores[doc_str] += 1.0 / (k + rank + 1)
    
    # æ’åºå¹¶è¿”å›ç»“æœ
    sorted_results = sorted(fused_scores.items(), 
                          key=lambda x: x[1], 
                          reverse=True)
    return sorted_results
```


RRF ç®—æ³•åŸç†å¦‚ä¸‹


```python
"""
RRF (Reciprocal Rank Fusion) ç®—æ³•çš„æ ¸å¿ƒå…¬å¼ï¼š

RRFscore(d âˆˆ D) = âˆ‘ 1/(k + r(d))
å…¶ä¸­ï¼š
- d æ˜¯æ–‡æ¡£
- D æ˜¯æ‰€æœ‰æ–‡æ¡£é›†åˆ
- k æ˜¯ä¸€ä¸ªå¸¸æ•°(é€šå¸¸å–60)
- r(d)æ˜¯æ–‡æ¡£dåœ¨æ’åºä¸­çš„ä½ç½®

è¿™ä¸ªå…¬å¼çš„ç‰¹ç‚¹ï¼š
1. å¯¹æ’åé å‰çš„æ–‡æ¡£ç»™äºˆæ›´é«˜çš„æƒé‡
2. kå‚æ•°å¯ä»¥è°ƒèŠ‚æ’åçš„å½±å“ç¨‹åº¦
3. é€‚åˆèåˆä¸åŒæ¥æºçš„æ’åºç»“æœ
"""
```


# ä¼˜åŒ–æ•ˆæœåˆ†æ


å¤šæŸ¥è¯¢æ£€ç´¢ç­–ç•¥å¸¦æ¥çš„ä¸»è¦ä¼˜åŠ¿ï¼š


1. **æå‡å¬å›ç‡**
    - é€šè¿‡å¤šè§’åº¦æŸ¥è¯¢æé«˜ç›¸å…³æ–‡æ¡£çš„è¦†ç›–ç‡
    - å‡å°‘å› å•ä¸€æŸ¥è¯¢è¡¨è¾¾ä¸å½“å¯¼è‡´çš„æ¼æ£€

2. **æé«˜å‡†ç¡®æ€§**
    - RRFèåˆç®—æ³•å¯ä»¥çªå‡ºé«˜è´¨é‡çš„å…±åŒç»“æœ
    - é™ä½å•ä¸ªæŸ¥è¯¢çš„å™ªå£°å½±å“

3. **å¢å¼ºé²æ£’æ€§**
    - å¯¹æŸ¥è¯¢è¡¨è¾¾çš„å˜åŒ–æ›´ä¸æ•æ„Ÿ
    - èƒ½æ›´å¥½åœ°å¤„ç†å¤æ‚æˆ–æ¨¡ç³Šçš„é—®é¢˜

# å®è·µå»ºè®®


åœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š


- **æŸ¥è¯¢æ•°é‡é€‰æ‹©**ï¼šé€šå¸¸ç”Ÿæˆ3-5ä¸ªæŸ¥è¯¢å³å¯ï¼Œè¿‡å¤šæŸ¥è¯¢å¯èƒ½å¼•å…¥å™ªå£°

- **ç›¸ä¼¼åº¦é˜ˆå€¼è®¾ç½®**ï¼šå»ºè®®åœ¨RRFèåˆæ—¶è®¾ç½®åˆé€‚çš„ç›¸ä¼¼åº¦é˜ˆå€¼ï¼Œè¿‡æ»¤ä½ç›¸å…³æ€§ç»“æœ

- **èµ„æºæ¶ˆè€—è€ƒè™‘**ï¼šå¤šæŸ¥è¯¢ä¼šå¢åŠ APIè°ƒç”¨å’Œè®¡ç®—èµ„æºï¼Œéœ€è¦åœ¨æ•ˆæœå’Œæˆæœ¬é—´æƒè¡¡

> ğŸ’¡ å®è·µå°è´´å£«ï¼šå¯ä»¥é€šè¿‡ç›‘æ§æ£€ç´¢ç»“æœçš„diversityå’ŒrelevanceæŒ‡æ ‡ï¼Œæ¥è°ƒæ•´å¤šæŸ¥è¯¢ç­–ç•¥çš„å‚æ•°ã€‚


# ç¬¬äºŒéƒ¨åˆ†ï¼šé—®é¢˜åˆ†è§£ç­–ç•¥ä¼˜åŒ–


# å¤æ‚é—®é¢˜çš„åˆ†è§£å¤„ç†


åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°å¤æ‚çš„å¤šå±‚æ¬¡é—®é¢˜ã€‚ä¾‹å¦‚ï¼š"è¯·åˆ†æç‰¹æ–¯æ‹‰è¿‘äº”å¹´çš„è´¢åŠ¡çŠ¶å†µï¼Œå¹¶è¯„ä¼°å…¶åœ¨ç”µåŠ¨æ±½è½¦å¸‚åœºçš„ç«äº‰ä¼˜åŠ¿ã€‚"è¿™ç±»é—®é¢˜éœ€è¦ï¼š


- å¤„ç†å¤§é‡ç›¸å…³ä¿¡æ¯

- åˆ†æå¤šä¸ªç»´åº¦

- ç»¼åˆå¤šæ–¹é¢ç»“è®º

# **å¹¶è¡Œåˆ†è§£æ¨¡å¼**


> ğŸ”„ å¹¶è¡Œæ¨¡å¼ï¼šå°†é—®é¢˜åŒæ—¶åˆ†è§£ä¸ºå¤šä¸ªç‹¬ç«‹å­é—®é¢˜ï¼Œåˆ†åˆ«è·å–ç­”æ¡ˆååˆå¹¶ã€‚


```python
# å¹¶è¡Œåˆ†è§£ç¤ºä¾‹
decomposition_chain = {
    "question": RunnablePassthrough(),
    | decomposition_prompt    # åˆ†è§£é—®é¢˜
    | ChatOpenAI(temperature=0)
    | StrOutputParser()
}

# å¹¶è¡Œå¤„ç†å­é—®é¢˜
sub_questions = decomposition_chain.invoke(question)
answers = await asyncio.gather(*[
    process_subquestion(q) for q in sub_questions
])
```


# **ä¸²è¡Œåˆ†è§£æ¨¡å¼**


> â›“ï¸ ä¸²è¡Œæ¨¡å¼ï¼šæŒ‰ç…§é€»è¾‘é¡ºåºä¾æ¬¡å¤„ç†å­é—®é¢˜ï¼Œåé¢çš„é—®é¢˜ä¾èµ–å‰é¢çš„ç­”æ¡ˆã€‚


```python
# ä¸²è¡Œåˆ†è§£ç¤ºä¾‹
class StepBackRetriever(BaseRetriever):
    def _get_relevant_documents(
        self, query: str, *, run_manager: CallbackManagerForRetrieverRun
    ) -> List[Document]:
        # 1. ç”Ÿæˆä¸­é—´æŸ¥è¯¢
        intermediate_query = self.llm.predict(
            f"ä¸ºäº†å›ç­”'{query}'ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä»€ä¹ˆï¼Ÿ"
        )
        
        # 2. æ£€ç´¢ä¸­é—´çŸ¥è¯†
        intermediate_docs = self.retriever.get_relevant_documents(
            intermediate_query
        )
        
        # 3. åŸºäºä¸­é—´çŸ¥è¯†æ£€ç´¢æœ€ç»ˆç­”æ¡ˆ
        final_docs = self.retriever.get_relevant_documents(query)
        
        return intermediate_docs + final_docs
```


# Step-Back ç­–ç•¥å®ç°


Step-Backç­–ç•¥æ˜¯ä¸€ç§ç‰¹æ®Šçš„ä¸²è¡Œåˆ†è§£æ–¹æ³•ï¼Œå®ƒé€šè¿‡â€œåé€€ä¸€æ­¥â€æ¥è·å–æ›´åŸºç¡€çš„çŸ¥è¯†èƒŒæ™¯ã€‚


```python
"""
ç¤ºä¾‹ï¼šç”¨æˆ·é—®é¢˜"é‡å­è®¡ç®—æœºå¦‚ä½•å½±å“ç°ä»£å¯†ç å­¦ï¼Ÿ"

Step-Backåˆ†è§£ï¼š
1. åŸºç¡€çŸ¥è¯†æŸ¥è¯¢ï¼š
   - ä»€ä¹ˆæ˜¯é‡å­è®¡ç®—æœºçš„åŸºæœ¬åŸç†ï¼Ÿ
   - ç°ä»£å¯†ç å­¦çš„æ ¸å¿ƒæŠ€æœ¯æœ‰å“ªäº›ï¼Ÿ

2. å…³è”åˆ†æï¼š
   - é‡å­è®¡ç®—å¯¹RSAç­‰ç®—æ³•çš„å½±å“
   - åé‡å­å¯†ç å­¦çš„å‘å±•

3. æœ€ç»ˆç»¼åˆï¼š
   åŸºäºä»¥ä¸ŠçŸ¥è¯†å½¢æˆå®Œæ•´ç­”æ¡ˆ
"""
```


**å·¥ä½œæµç¨‹**ï¼š


1. åˆ†æåŸå§‹é—®é¢˜

2. ç”Ÿæˆæ›´åŸºç¡€çš„å‰ç½®é—®é¢˜

3. è·å–åŸºç¡€çŸ¥è¯†

4. ç»“åˆåŸºç¡€çŸ¥è¯†å›ç­”åŸé—®é¢˜

# Step-Back ä»£ç å®ç°


```python
# 
system_prompt = """
ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„åŠ©æ‰‹ï¼Œéœ€è¦ï¼š
1. ç†è§£ç”¨æˆ·çš„å…·ä½“é—®é¢˜
2. æ€è€ƒéœ€è¦å“ªäº›åŸºç¡€çŸ¥è¯†
3. ç”Ÿæˆç›¸å…³çš„åŸºç¡€é—®é¢˜
4. åŸºäºåŸºç¡€çŸ¥è¯†å›ç­”åŸé—®é¢˜
"""

few_shot_prompt = FewShotChatMessagePromptTemplate(
    example_prompt=example_prompt,
    examples=examples,
    suffix="ç°åœ¨ï¼Œè¯·å¸®æˆ‘å›ç­”ï¼š{question}"
)
```


# ä¼˜åŒ–æ•ˆæœå¯¹æ¯”


| åˆ†è§£ç­–ç•¥ | é€‚ç”¨åœºæ™¯ | ä¼˜åŠ¿ | åŠ£åŠ¿ |
| --- | --- | --- | --- |
| å¹¶è¡Œåˆ†è§£ | ç‹¬ç«‹å­é—®é¢˜ | å¤„ç†é€Ÿåº¦å¿«ï¼Œèµ„æºåˆ©ç”¨é«˜ | ç»“æœæ•´åˆå¯èƒ½ä¸å¤Ÿè¿è´¯ |
| ä¸²è¡Œåˆ†è§£ | é€»è¾‘ä¾èµ–æ€§å¼º | ç­”æ¡ˆæ›´è¿è´¯ï¼Œé€»è¾‘æ€§å¼º | å¤„ç†æ—¶é—´è¾ƒé•¿ |
| Step-Back | éœ€è¦æ·±å…¥ç†è§£ | å›ç­”æ›´å…¨é¢ï¼Œå‡†ç¡®åº¦é«˜ | èµ„æºæ¶ˆè€—è¾ƒå¤§ |


# å®è·µå»ºè®®


1. é€‰æ‹©ç­–ç•¥æ—¶è€ƒè™‘å› ç´ : 
    - é—®é¢˜çš„å¤æ‚åº¦
    - å­é—®é¢˜é—´çš„ä¾èµ–å…³ç³»
    - å“åº”æ—¶é—´è¦æ±‚
    - èµ„æºé™åˆ¶

2. ä¼˜åŒ–å»ºè®®ï¼š
    - å¯¹äºå¹¶è¡Œæ¨¡å¼ï¼Œæ³¨æ„ç»“æœèåˆçš„è´¨é‡
    - ä¸²è¡Œæ¨¡å¼è¦æ§åˆ¶åˆ†è§£çš„å±‚çº§æ·±åº¦
    - Step-Backç­–ç•¥è¦å¹³è¡¡åŸºç¡€çŸ¥è¯†çš„èŒƒå›´

> ğŸŒŸ æœ€ä½³å®è·µï¼šå¯ä»¥æ ¹æ®é—®é¢˜ç±»å‹åŠ¨æ€é€‰æ‹©åˆ†è§£ç­–ç•¥ï¼Œç”šè‡³ç»„åˆä½¿ç”¨å¤šç§ç­–ç•¥ã€‚


# ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ··åˆæ£€ç´¢ç­–ç•¥å®ç°


# ç†è§£æ··åˆæ£€ç´¢çš„ä»·å€¼


åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå•ä¸€çš„æ£€ç´¢æ–¹æ³•å¾€å¾€éš¾ä»¥åº”å¯¹æ‰€æœ‰åœºæ™¯ã€‚ä¾‹å¦‚ï¼š


- è¯­ä¹‰æ£€ç´¢æ“…é•¿ç†è§£ä¸Šä¸‹æ–‡ï¼Œä½†å¯èƒ½é”™è¿‡å…³é”®è¯

- å…³é”®è¯æ£€ç´¢å‡†ç¡®åº¦é«˜ï¼Œä½†ç¼ºä¹è¯­ä¹‰ç†è§£

- å¯†é›†æ£€ç´¢å’Œç¨€ç–æ£€ç´¢å„æœ‰ä¼˜åŠ¿

å› æ­¤ï¼Œå°†å¤šç§æ£€ç´¢æ–¹æ³•ç»“åˆèµ·æ¥ï¼Œå¯ä»¥å–é•¿è¡¥çŸ­ï¼Œæå‡æ•´ä½“æ£€ç´¢æ•ˆæœã€‚


# æ··åˆæ£€ç´¢å™¨çš„æ¶æ„è®¾è®¡


```python
from langchain.retrievers import EnsembleRetriever
from langchain_community.retrievers import BM25Retriever
from langchain_community.vectorstores import FAISS

# 1. åˆ›å»ºä¸åŒç±»å‹çš„æ£€ç´¢å™¨
# BM25æ£€ç´¢å™¨ï¼ˆåŸºäºå…³é”®è¯ï¼‰
bm25_retriever = BM25Retriever.from_documents(
    documents, k=4
)

# FAISSæ£€ç´¢å™¨ï¼ˆåŸºäºå‘é‡ï¼‰
faiss_retriever = FAISS.from_documents(
    documents,
    embedding=OpenAIEmbeddings(model="text-embedding-3-small")
).as_retriever(search_kwargs={"k": 4})

# 2. åˆ›å»ºé›†æˆæ£€ç´¢å™¨
ensemble_retriever = EnsembleRetriever(
    retrievers=[bm25_retriever, faiss_retriever],
    weights=[0.5, 0.5]
)
```


# ä¸»è¦æ£€ç´¢æ–¹æ³•çš„ç‰¹ç‚¹


ä¸‹é¢æ˜¯å‡ ç§å¸¸ç”¨æ£€ç´¢æ–¹æ³•çš„å¯¹æ¯”ï¼š


| æ£€ç´¢æ–¹æ³• | ä¼˜åŠ¿ | é€‚ç”¨åœºæ™¯ | æ³¨æ„äº‹é¡¹ |
| --- | --- | --- | --- |
| BM25 | ç²¾ç¡®åŒ¹é…ï¼Œé€Ÿåº¦å¿« | å…³é”®è¯æœç´¢ | ä¸ç†è§£è¯­ä¹‰å˜åŒ– |
| å‘é‡æ£€ç´¢ | ç†è§£è¯­ä¹‰ç›¸ä¼¼ | æ¦‚å¿µæœç´¢ | è®¡ç®—èµ„æºæ¶ˆè€—å¤§ |
| æ··åˆæ£€ç´¢ | ç»¼åˆä¼˜åŠ¿ | å¤æ‚æŸ¥è¯¢ | éœ€è¦è°ƒæ•´æƒé‡ |


# å®ç°ç»†èŠ‚å’Œä¼˜åŒ–


**æ£€ç´¢å™¨é…ç½®**


```python
# é…ç½®æ£€ç´¢å‚æ•°
faiss_retriever = faiss_db.as_retriever(
    search_kwargs={"k": 4}
).configurable_fields(
    search_kwargs=ConfigurableField(
        id="search_kwargs_faiss",
        name="æ£€ç´¢å‚æ•°",
        description="è®¾ç½®æ£€ç´¢çš„å‚æ•°"
    )
)

# è®¾ç½®è¿è¡Œæ—¶é…ç½®
config = {"configurable": {"search_kwargs_faiss": {"k": 4}}}
docs = ensemble_retriever.invoke("æŸ¥è¯¢", config=config)
```


**æƒé‡è°ƒæ•´ç­–ç•¥**


1. **åˆå§‹è®¾ç½®**ï¼šå¼€å§‹æ—¶å¯ä»¥ç»™å„æ£€ç´¢å™¨ç›¸åŒæƒé‡

2. **åŠ¨æ€è°ƒæ•´**ï¼šæ ¹æ®æŸ¥è¯¢ç±»å‹åŠ¨æ€è°ƒæ•´æƒé‡

3. **æ€§èƒ½ç›‘æ§**ï¼šè·Ÿè¸ªå„æ£€ç´¢å™¨çš„è¡¨ç°ï¼Œå®šæœŸä¼˜åŒ–æƒé‡

4. **åœºæ™¯é€‚é…**ï¼šé’ˆå¯¹ä¸åŒé¢†åŸŸè°ƒæ•´æœ€ä¼˜æƒé‡ç»„åˆ

# åº”ç”¨æ•ˆæœä¼˜åŒ–


ä¸ºäº†è·å¾—æœ€ä½³æ£€ç´¢æ•ˆæœï¼Œå»ºè®®ï¼š


1. æ£€ç´¢å™¨é€‰æ‹©
    - æ ¹æ®æ•°æ®ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„æ£€ç´¢å™¨ç»„åˆ
    - è€ƒè™‘è®¡ç®—èµ„æºå’Œå“åº”æ—¶é—´çš„å¹³è¡¡
    - è¯„ä¼°æ£€ç´¢å™¨çš„äº’è¡¥æ€§

2. å‚æ•°ä¼˜åŒ–
    - ä½¿ç”¨éªŒè¯é›†è°ƒæ•´æ£€ç´¢å‚æ•°
    - ç›‘æ§æ£€ç´¢è´¨é‡æŒ‡æ ‡
    - å®šæœŸæ›´æ–°æ£€ç´¢æ¨¡å‹

3. ç»“æœèåˆ
    - é‡‡ç”¨å¤šæ ·åŒ–çš„èåˆç­–ç•¥
    - è€ƒè™‘ç»“æœçš„å»é‡å’Œæ’åº
    - å¹³è¡¡ç›¸å…³æ€§å’Œå¤šæ ·æ€§

# æ€§èƒ½ç›‘æ§ä¸æ”¹è¿›


```python
# æ€§èƒ½ç›‘æ§ç¤ºä¾‹
def evaluate_retrieval(retriever, test_queries, ground_truth):
    metrics = {
        'precision': [],
        'recall': [],
        'latency': []
    }
    
    for query, truth in zip(test_queries, ground_truth):
        start_time = time.time()
        results = retriever.get_relevant_documents(query)
        latency = time.time() - start_time
        
        # è®¡ç®—è¯„ä¼°æŒ‡æ ‡
        metrics['latency'].append(latency)
        # ... è®¡ç®—precisionå’Œrecall
        
    return metrics
```


# æ€»ç»“ï¼šRAGä¼˜åŒ–ç­–ç•¥çš„å®è·µæŒ‡å—


# ä¼˜åŒ–ç­–ç•¥çš„ç»¼åˆæ¯”è¾ƒ


ä»¥ä¸‹æ˜¯æˆ‘ä»¬è®¨è®ºè¿‡çš„ä¸»è¦ä¼˜åŒ–ç­–ç•¥çš„ç‰¹ç‚¹å¯¹æ¯”ï¼š


| ä¼˜åŒ–ç­–ç•¥ | ä¸»è¦ä¼˜åŠ¿ | å®ç°å¤æ‚åº¦ | èµ„æºæ¶ˆè€— | é€‚ç”¨åœºæ™¯ |
| --- | --- | --- | --- | --- |
| å¤šæŸ¥è¯¢æ£€ç´¢ | æé«˜å¬å›ç‡ | ä¸­ç­‰ | ä¸­ç­‰ | å¤æ‚æŸ¥è¯¢ã€æ¨¡ç³Šé—®é¢˜ |
| é—®é¢˜åˆ†è§£ | æå‡ç†è§£æ·±åº¦ | è¾ƒé«˜ | è¾ƒé«˜ | å¤šç»´åº¦åˆ†æé—®é¢˜ |
| Step-Back | å¢å¼ºç†è§£å‡†ç¡®æ€§ | é«˜ | é«˜ | éœ€è¦æ·±å…¥ç†è§£çš„é—®é¢˜ |
| æ··åˆæ£€ç´¢ | ç»¼åˆæ€§èƒ½æå‡ | ä¸­ç­‰ | è¾ƒé«˜ | é€šç”¨åœºæ™¯ |


# ä¼˜åŒ–è·¯å¾„å»ºè®®


**å¾ªåºæ¸è¿›çš„ä¼˜åŒ–è·¯çº¿**

